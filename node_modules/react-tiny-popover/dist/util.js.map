{"version":3,"file":"util.js","sourceRoot":"","sources":["../src/util.ts"],"names":[],"mappings":"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","sourcesContent":["import { PopoverPosition, PopoverState, PopoverAlign } from './index';\n\nexport const Constants = {\n  POPOVER_CONTAINER_CLASS_NAME: 'react-tiny-popover-container',\n  DEFAULT_ALIGN: 'center' as PopoverAlign,\n  OBSERVER_THRESHOLDS: Array(1000)\n    .fill(null)\n    .map((_, i) => i / 1000)\n    .reverse(),\n  DEFAULT_POSITIONS: ['top', 'left', 'right', 'bottom'] as PopoverPosition[],\n  EMPTY_CLIENT_RECT: {\n    top: 0,\n    left: 0,\n    bottom: 0,\n    height: 0,\n    right: 0,\n    width: 0,\n  } as ClientRect,\n} as const;\n\nexport const arrayUnique = <T>(array: T[]): T[] =>\n  array.filter((value: any, index: number, self: T[]) => self.indexOf(value) === index);\n\nexport const rectsAreEqual = (rectA: ClientRect, rectB: ClientRect) =>\n  rectA === rectB ||\n  (rectA?.bottom === rectB?.bottom &&\n    rectA?.height === rectB?.height &&\n    rectA?.left === rectB?.left &&\n    rectA?.right === rectB?.right &&\n    rectA?.top === rectB?.top &&\n    rectA?.width === rectB?.width);\n\nexport const popoverStatesAreEqual = (stateA: PopoverState, stateB: PopoverState): boolean =>\n  stateA === stateB ||\n  (stateA?.align === stateB?.align &&\n    stateA?.nudgedLeft === stateB?.nudgedLeft &&\n    stateA?.nudgedTop === stateB?.nudgedTop &&\n    stateA.padding === stateB.padding &&\n    rectsAreEqual(stateA?.popoverRect, stateB?.popoverRect) &&\n    rectsAreEqual(stateA?.childRect, stateB?.childRect) &&\n    stateA?.position === stateB?.position);\n\nexport const targetPositionHasChanged = (oldRect: ClientRect, newRect: ClientRect): boolean =>\n  oldRect === undefined ||\n  oldRect.left !== newRect.left ||\n  oldRect.top !== newRect.top ||\n  oldRect.width !== newRect.width ||\n  oldRect.height !== newRect.height;\n\nexport const createContainer = (\n  containerStyle?: Partial<CSSStyleDeclaration>,\n  containerClassName?: string,\n) => {\n  const container = window.document.createElement('div');\n  if (containerClassName) container.className = containerClassName;\n  Object.assign(container.style, containerStyle);\n  return container;\n};\n\nexport const getBoundingRectNeglectingPositionalTransform = (\n  element?: HTMLElement | null,\n): ClientRect | undefined => {\n  if (element == null) return undefined;\n\n  let el = element;\n  let top = 0;\n  let left = 0;\n\n  do {\n    top += el.offsetTop;\n    left += el.offsetLeft;\n    el = el.offsetParent as HTMLElement;\n  } while (el != null);\n\n  let scrollTop = 0;\n  let scrollLeft = 0;\n\n  el = element;\n  do {\n    scrollTop += el.scrollTop;\n    scrollLeft += el.scrollLeft;\n    el = el.parentElement;\n  } while (el != null);\n\n  top -= scrollTop;\n  left -= scrollLeft;\n\n  const { width, height } = element.getBoundingClientRect();\n  return { top, left, width, height, bottom: top + height, right: left + width };\n};\n\nexport const popoverRectForPosition = (\n  position: PopoverPosition,\n  childRect: ClientRect,\n  popoverRect: ClientRect,\n  padding: number,\n  align: PopoverAlign,\n): ClientRect => {\n  const targetMidX = childRect.left + childRect.width / 2;\n  const targetMidY = childRect.top + childRect.height / 2;\n  const { width, height } = popoverRect;\n  let top: number;\n  let left: number;\n\n  switch (position) {\n    case 'left':\n      top = targetMidY - height / 2;\n      left = childRect.left - padding - width;\n      if (align === 'start') {\n        top = childRect.top;\n      }\n      if (align === 'end') {\n        top = childRect.bottom - height;\n      }\n      break;\n    case 'bottom':\n      top = childRect.bottom + padding;\n      left = targetMidX - width / 2;\n      if (align === 'start') {\n        left = childRect.left;\n      }\n      if (align === 'end') {\n        left = childRect.right - width;\n      }\n      break;\n    case 'right':\n      top = targetMidY - height / 2;\n      left = childRect.right + padding;\n      if (align === 'start') {\n        top = childRect.top;\n      }\n      if (align === 'end') {\n        top = childRect.bottom - height;\n      }\n      break;\n    default:\n      top = childRect.top - height - padding;\n      left = targetMidX - width / 2;\n      if (align === 'start') {\n        left = childRect.left;\n      }\n      if (align === 'end') {\n        left = childRect.right - width;\n      }\n      break;\n  }\n\n  return { top, left, width, height, right: left + width, bottom: top + height };\n};\n\ninterface GetNewPopoverRectProps {\n  position: PopoverPosition;\n  reposition: boolean;\n  align: PopoverAlign;\n  childRect: ClientRect;\n  popoverRect: ClientRect;\n  boundaryRect: ClientRect;\n  padding: number;\n}\n\nexport const getNewPopoverRect = (\n  {\n    position,\n    align,\n    childRect,\n    popoverRect,\n    boundaryRect,\n    padding,\n    reposition,\n  }: GetNewPopoverRectProps,\n  boundaryInset: number,\n) => {\n  const rect = popoverRectForPosition(position, childRect, popoverRect, padding, align);\n\n  const boundaryViolation =\n    reposition &&\n    ((position === 'top' && rect.top < boundaryRect.top + boundaryInset) ||\n      (position === 'left' && rect.left < boundaryRect.left + boundaryInset) ||\n      (position === 'right' && rect.right > boundaryRect.right - boundaryInset) ||\n      (position === 'bottom' && rect.bottom > boundaryRect.bottom - boundaryInset));\n\n  return {\n    rect,\n    boundaryViolation,\n  };\n};\n\nexport const getNudgedPopoverRect = (\n  popoverRect: ClientRect,\n  boundaryRect: ClientRect,\n  boundaryInset: number,\n): ClientRect => {\n  const topBoundary = boundaryRect.top + boundaryInset;\n  const leftBoundary = boundaryRect.left + boundaryInset;\n  const rightBoundary = boundaryRect.right - boundaryInset;\n  const bottomBoundary = boundaryRect.bottom - boundaryInset;\n\n  let top = popoverRect.top < topBoundary ? topBoundary : popoverRect.top;\n  top = top + popoverRect.height > bottomBoundary ? bottomBoundary - popoverRect.height : top;\n  let left = popoverRect.left < leftBoundary ? leftBoundary : popoverRect.left;\n  left = left + popoverRect.width > rightBoundary ? rightBoundary - popoverRect.width : left;\n\n  return {\n    top,\n    left,\n    width: popoverRect.width,\n    height: popoverRect.height,\n    right: left + popoverRect.width,\n    bottom: top + popoverRect.height,\n  };\n};\n"]}